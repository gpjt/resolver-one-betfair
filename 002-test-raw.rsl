<!--
This spreadsheet is copyright 2010, all rights reserved.
-->
<document currentResultWorksheet="Sheet1" verticalSplitterRatio="0.75" horizontalSplitterRatio="0.464922711058" splitterOrientation="Horizontal" suspendRecalculations="False" license="Closed source/proprietary" copyrightOwner="" resolverVersion="1.8" resolverBuild="5055" documentVersion="12">
    <foldState license="True" imports="True" worksheetCreation="True" preConstantsUserCode="False" constants="True" preFormulaeUserCode="False" generated="False" postFormulaeUserCode="False"/>
    <traitDefaults>
        <traitDefault name='ColWidth' value='82' />
        <traitDefault name='FontSize' value='10.0' />
        <traitDefault name='RowHeight' value='22' />
    </traitDefaults>
    <preConstantsUserCode><![CDATA[
]]></preConstantsUserCode>
    <preFormulaeUserCode><![CDATA[
import clr
clr.AddReference("betfair")
from BetfairSOAPAPI import *

globalService = BFGlobalService()
exchangeService = BFExchangeService()

request = LoginReq(username="YOUR_USERNAME", password="YOUR_PASSWORD", productId=82)
response = globalService.login(request)
if response.errorCode != LoginErrorEnum.OK:
    print "Login failed"
    raise Exception("Failure")
print "Login successful"
sessionToken = response.header.sessionToken
    
request = GetAllMarketsReq()
request.header = APIRequestHeader(sessionToken=sessionToken)
response = exchangeService.getAllMarkets(request)

def SplitOnDelimiter(delimiter, string):
    words = []
    inEscapedChar = False
    nextWord = []
    for c in string:
        if not inEscapedChar:
            if c == delimiter:
                words.append(''.join(nextWord))
                nextWord = []
                continue
            elif c == '\\':
                inEscapedChar = True
        else:
            inEscapedChar = False
        nextWord.append(c)
    words.append(''.join(nextWord))
    return words

     

def DateTimeFromPosix(milliseconds):
    return DateTime(1970, 1, 1).AddMilliseconds(milliseconds)    
    
class Market(object):
    @classmethod
    def fromRecordString(cls, recordString):
        fields = SplitOnDelimiter('~', recordString)
        market = cls(int(fields[0]))

        market.Name = fields[1]
        market.Type = fields[2]
        market.Status = fields[3]
        market.StartDate = DateTimeFromPosix(int(fields[4]))
        market.Path = fields[5]
        market.EventHierarchy = fields[6]
        market.BetDelay = fields[7]
        market.ExchangeId = int(fields[8])
        market.CountryCode = fields[9]
        market.LastRefresh = DateTimeFromPosix(int(fields[10]))
        market.NumberOfRunners = int(fields[11])
        market.NumberOfWinners = int(fields[12])
        market.TotalAmountMatched = float(fields[13])
        market.BSPMarket = fields[14] == "Y"
        market.TurningInPlay = fields[15] == "Y"
        return market

    def __init__(self, id):
        self.Id = id
   
    def __str__(self):
        return "Market: %s" % (self.Name, )

rowIter = workbook["Sheet1"].AllRowsFromIndex(2)
fields = [value for value in workbook["Sheet1"].Rows[1]]
for marketData in SplitOnDelimiter(':', response.marketData):
    if marketData != '':
        market = Market.fromRecordString(marketData)
        row = rowIter.next()
        row[1] = market


]]></preFormulaeUserCode>
    <names />
    <viewStates>
        <viewState worksheet="Sheet1">
            <currentCell col="4" row="3" />
            <scrollPos col="1" row="1" />
            <virtualGridSize width="15" height="13" />
        </viewState>
        <viewState worksheet="Sheet2">
            <currentCell col="1" row="1" />
            <scrollPos col="1" row="1" />
            <virtualGridSize width="100" height="100" />
        </viewState>
        <viewState worksheet="Sheet3">
            <currentCell col="1" row="1" />
            <scrollPos col="1" row="1" />
            <virtualGridSize width="100" height="100" />
        </viewState>
    </viewStates>
    <worksheetOrder>
        <orderentry name="Sheet1" />
        <orderentry name="Sheet2" />
        <orderentry name="Sheet3" />
    </worksheetOrder>
    <worksheet name="Sheet1" value="" showGrid="True" showBounds="False" headerWidth="51" headerHeight="-1">
        <trait name="FontSize">
        </trait>
        <trait name="BorderBottom">
        </trait>
        <trait name="ShowNegativeSymbol">
        </trait>
        <trait name="Unit">
        </trait>
        <trait name="ColWidth">
            <traitentry col="1" row="0" value="212" />
            <traitentry col="2" row="0" value="81" />
            <traitentry col="5" row="0" value="341" />
            <traitentry col="8" row="0" value="97" />
            <traitentry col="9" row="0" value="107" />
            <traitentry col="10" row="0" value="119" />
            <traitentry col="11" row="0" value="141" />
            <traitentry col="12" row="0" value="145" />
            <traitentry col="13" row="0" value="139" />
            <traitentry col="14" row="0" value="127" />
            <traitentry col="15" row="0" value="111" />
        </trait>
        <trait name="Alignment">
        </trait>
        <trait name="BorderTop">
        </trait>
        <trait name="WebEditable">
        </trait>
        <trait name="Italic">
        </trait>
        <trait name="FontFamily">
        </trait>
        <trait name="ShowSeparators">
        </trait>
        <trait name="VerticalAlignment">
        </trait>
        <trait name="Formatter">
        </trait>
        <trait name="Underline">
        </trait>
        <trait name="Color">
        </trait>
        <trait name="RowHidden">
        </trait>
        <trait name="BorderLeft">
        </trait>
        <trait name="StripZeros">
        </trait>
        <trait name="ColHidden">
        </trait>
        <trait name="Wrap">
        </trait>
        <trait name="NegativeTextColor">
        </trait>
        <trait name="BorderRight">
        </trait>
        <trait name="RowHeight">
        </trait>
        <trait name="BackColor">
        </trait>
        <trait name="Bold">
            <traitentry col="0" row="1" value="True" />
        </trait>
        <trait name="Strikethrough">
        </trait>
        <trait name="ImagePlacement">
        </trait>
        <trait name="DecimalPlaces">
        </trait>
        <cell name="A1" value="Market object" type="general">
        </cell>
    </worksheet>
    <worksheet name="Sheet2" value="" showGrid="True" showBounds="False" headerWidth="-1" headerHeight="-1">
        <trait name="FontSize">
        </trait>
        <trait name="BorderBottom">
        </trait>
        <trait name="ShowNegativeSymbol">
        </trait>
        <trait name="Unit">
        </trait>
        <trait name="ColWidth">
        </trait>
        <trait name="Alignment">
        </trait>
        <trait name="BorderTop">
        </trait>
        <trait name="WebEditable">
        </trait>
        <trait name="Italic">
        </trait>
        <trait name="FontFamily">
        </trait>
        <trait name="ShowSeparators">
        </trait>
        <trait name="VerticalAlignment">
        </trait>
        <trait name="Formatter">
        </trait>
        <trait name="Underline">
        </trait>
        <trait name="Color">
        </trait>
        <trait name="RowHidden">
        </trait>
        <trait name="BorderLeft">
        </trait>
        <trait name="StripZeros">
        </trait>
        <trait name="ColHidden">
        </trait>
        <trait name="Wrap">
        </trait>
        <trait name="NegativeTextColor">
        </trait>
        <trait name="BorderRight">
        </trait>
        <trait name="RowHeight">
        </trait>
        <trait name="BackColor">
        </trait>
        <trait name="Bold">
        </trait>
        <trait name="Strikethrough">
        </trait>
        <trait name="ImagePlacement">
        </trait>
        <trait name="DecimalPlaces">
        </trait>
    </worksheet>
    <worksheet name="Sheet3" value="" showGrid="True" showBounds="False" headerWidth="-1" headerHeight="-1">
        <trait name="FontSize">
        </trait>
        <trait name="BorderBottom">
        </trait>
        <trait name="ShowNegativeSymbol">
        </trait>
        <trait name="Unit">
        </trait>
        <trait name="ColWidth">
        </trait>
        <trait name="Alignment">
        </trait>
        <trait name="BorderTop">
        </trait>
        <trait name="WebEditable">
        </trait>
        <trait name="Italic">
        </trait>
        <trait name="FontFamily">
        </trait>
        <trait name="ShowSeparators">
        </trait>
        <trait name="VerticalAlignment">
        </trait>
        <trait name="Formatter">
        </trait>
        <trait name="Underline">
        </trait>
        <trait name="Color">
        </trait>
        <trait name="RowHidden">
        </trait>
        <trait name="BorderLeft">
        </trait>
        <trait name="StripZeros">
        </trait>
        <trait name="ColHidden">
        </trait>
        <trait name="Wrap">
        </trait>
        <trait name="NegativeTextColor">
        </trait>
        <trait name="BorderRight">
        </trait>
        <trait name="RowHeight">
        </trait>
        <trait name="BackColor">
        </trait>
        <trait name="Bold">
        </trait>
        <trait name="Strikethrough">
        </trait>
        <trait name="ImagePlacement">
        </trait>
        <trait name="DecimalPlaces">
        </trait>
    </worksheet>
    <postFormulaeUserCode><![CDATA[
]]></postFormulaeUserCode>
</document>
